# Part 6. 파일 시스템(File system)

- `파일`은 작성자가 정의한 연관된 `정보의 모음`이다
- 파일은 운영체제에서 물리적 대용량 저장장치로 매핑된다
- `파일 시스템`은
  - `파일`이 `물리적 장치에 매핑`되는 방법과
  - 사용자와 프로그램이 `파일을 액세스하고 조작`하는 방법을 설명한다
- 물리적 저장장치에 대한 액세스 속도가 느릴 수 있으므로 효율적인 액세스를 목표로 파일 시스템을 설계해야 한다
- 파일 공유 및 파일에 대한 원격 액세스 지원을 포함하여 다른 요구 사항도 중요할 수 있다

# 13. 파일 시스템 인터페이스(File system interface)

- 파일 시스템은 가장 많이 노출되는 범용 운영체제의 부분이다
  - 온라인으로 저장하고 접근하는 기법 제공
- 파일 시스템의 두 부분
  - 정보 자료를 저장하는 실제적인 파일의 집합체
  - 시스템 내의 모든 파일 정보를 제공하는 디렉터리 구조
- 파일 시스템은 저장장치상에 구현된다
- 이번장에서 파일의 다양한 면과 주된 디렉터리 구조에 관해서 살펴보고
- 다중 프로세스, 사용자 그리고 컴퓨터 간에 파일을 공유하는 의미(semantics)를 알아본다
- 마지막으로, 다수의 사용자가 파일을 사용할 경우에 파일을 어떻게 보호할 것인가에 대한 보호 방법에 관하여 살펴본다

#### 이 장의 목표

- 파일 시스템의 기능을 설명한다
- 파일 시스템 인터페이스의 특징을 기술한다
- 접근 방법, 파일 공유, 파일 락, 디렉터리 구조를 포함하는 파일 시스템 설계 절충에 관해서 논한다
- 파일 시스템 보호에 대해서 고려해본다

## 13.1 파일 개념(File concept)

- 컴퓨터는 정보를 각기 다른 저장 매체에 저장할 수 있다
  - 저장 매채 : NVM 장치, HDD, 자기 디스크, 자기 테이프, 광디스크, ...
- 운영체제가 저장 정보에 대한 일과된 논리적 관점을 제공하고, 저장장치의 물리적 특성을 추상화하여 논리적 저장 단위, 즉 `파일`을 정의한다
- 파일은 운영체제에 의해 물리장치와 매핑된다
  - 저장장치들은 일반적으로 비휘발성이기 때문에 시스템이 재부팅 되어도 저장된 내용은 영구히 존속된다
- `파일`은 `보조저장장치에 기록된 관련 정보의 집합`으로 정의할 수 있다
  - 사용자 관점에소 볼 때 파일은 논리적 보조저장장치의 가장 작은 할당 요소이다
- 소스 또는 실행 프로그램, 숫자 또는 텍스트, 사진, 음악 비디오 등 다양한 정보들이 파일 내에 저장되고, 유형에 따라 특별히 정의된 구조를 가진다
  - 텍스트 파일 : 행들로 구성되는 연속된 문자들
  - 소스 파일 : 함수들의 연속, 각 함수는 선언과 실행문의 순서로 구성
  - 실행 파일 : 로더가 메모리로 가져와 실행시킬 수 있는 연속된 코드 부분들

### 13.1.1 파일 속성(File attributes)

- 파일은 운영체제마다 다른 속성을 갖지만 전형적으로 다음과 같은 속성들을 가진다
  - 이름 : 기호형 파일의 이름은 사람이 읽을 수 있는 형태로 유지된 유일한 정보이다
  - 식별자(identifier) : 이 고유의 꼬리표는 통상 하나의 숫자로 파일 시스템 내에서 파일을 확인한다
    - 식별자는 우리가 읽을 수 없는 파일의 이름이다
  - 유형 : 이 정보는 여러 유형을 제공하는 시스템을 위해 필요하다
  - 위치 : 이 정보는 파일이 존재하는 장치와 그 장치 내의 위치에 대한 포인터이다
  - 크기 : 파일의 현재 크기(바이트, 워드 혹은 블록들로 나타낸다)와 최대 허용 가능한 크기가 이 속성에 포함된다
  - 보호 : 접근 제어 정보는 누가 읽기, 쓰기, 실행 등을 할 수 있는가를 제어한다
  - 타임스탬프와 사용자 식별 : 이 정보는 생성, 최근 변경, 최근 사용 등을 유지하고, 이들 자료는 보호, 보안 및 사용자 감시를 위해 사용된다
- 디렉터리는 파일의 휘발성과 일치해야 하므로, 파일과 같이 장치에 저장되어야 하고, 필요할 때 마다 메모리로 조금씩 반입된다

### 13.1.2 파일 연산(File operations)

- 파일이란 추상적인 데이터 유형이다
- 파일을 적절히 정의하기 위해 파일에 대해 실행할 수 있는 연산을 고려해 볼 필요가 있다
- 운영체제는 파일을 위해 아래 시스템 콜들을 제공한다
  - 파일 생성
  - 열기
  - 쓰기
  - 읽기
  - 위치 재설정
  - 삭제
  - 절단
- 위 7개의 파일 연산에 대해 운영체제가 해야 할 일이 무서인가를 알아보자

#### 1. 파일 생성

- 파일 생성을 위해 2단계가 필요
  - 첫째, 파일을 저장할 수 있도록 파일 시스템 내에서 공간을 찾아야 한다
    - 14장에서 파일을 위한 공간 할당 방법을 기술하고 있다
  - 둘째, 새로 생성된 파일에 대한 항목이 디렉터리에 만들어져야한다

#### 2. 파일 열기

모든 파일 연산에서 파일 이름을 지정하게 하면 운영체제가 이름을 검사하고,

접근 권한을 확인하는 등의 작업을 매번 수행해야 하므로 생성과 삭제를 제외한 모든 연산을 하기 전에 반드시 파일을 open() 해야 한다

성공하면 open 콜은 다른 콜의 인자로 사용되는 파일 핸들을 반환한다

#### 3. 파일 쓰기

- 파일을 쓰기 위해서는 `열린 파일 핸들`과 `피일에 기록될 정보를 명시`하는 시스템 콜을 실행한다
- 시스템은 파일 내의 다음 순차적 쓰기가 일어날 위치를 가리키는 쓰기 포인터(write pointer)를 유지하고 있어야 한다
- 쓰기 포인터는 쓰기가 일어날 때마다 갱신되어야 한다

#### 4. 파일 읽기

- 파일을 읽기 위해서 파일 핸들과 파일이 읽혀야 할 블록의 위치(메모리 내)를 기술하는 시스템 콜을 사용한다
- 시스템은 순차적 읽기가 일어날 때 파일 안의 위치를 가리키는 읽기 포인터(read pointer)를 유지할 필요가 있다
- 프로세스는 일반적으로 파일 읽기나 파일 쓰기 중 하나를 하고 있기 때문에,
  - 대부분의 `시스템`은 `하나의` `현재 파일 위치 포인터(current file position pointer)`를 가진다
- 읽기와 쓰기 연산 모두 이 포인터를 사용함으로써 공간을 절약하고 시스템의 복잡성을 감소시킨다

#### 5. 파일 안에서의 위치 재설정(reposition)

- 열린 파일의 현재 파일 위치를 주어진 값으로 설정한다
- 파일 내에서 위치의 재설정을 위해 실제로 입출력할 필요는 없으며, 이 파일 연산은 파일 탐색(seek)으로도 알려져 있다

#### 6. 파일 삭제

- 파일을 삭제하기 위해 지정된 파일을 디렉터리에서 찾는다
- 해당 디렉터리 항목을 찾으면 다른 파일에서 재사용 할 수 있도록 모든 파일 곤간을 해제하고 디렉터리 항목을 지우거나 사용가능으로 표시한다
- 일부 시스템은 동일한 파일에 대해 여러 개의 이름(디렉터리 항목)이 존재할 수 있는 하드 링크를 허용한다
  - 이 경우 실제 파일 내용은 마지막 링크가 삭제될 때까지 삭제되지 않는다

#### 7. 파일 절단

- 사용자가 파일의 내용은 지우고 다만 그 파일의 속성은 그대로 남기기를 원할 때 사용한다
- 사용자가 파일을 삭제하고 파일을 재생성하게 하는 것이 아니라, 이 기능은 파일의 길이를 제외한 모든 속성은 그대로 유지하게 한다
- 파일의 길이가 0으로 재설정되며, 파일이 가지고 있던 공간으 해제될 수 있다

#### 파일 연산 정리

- 위 7개의 연산은 파일 조작에 필요한 최소 연산
- 이들 기본적인 조작 연산은 다른 조작 연산을 실행하기 위해 결합할 수도 있다
- 파일 복사 예시
  - 새로운 `파일을 생성`하고 `기존 파일을 읽어` `새로운 파일에 기록`함으로써 파일의 복사본을 생성할 수 있다

#### 열린 파일 테이블(Open-file table)

- 운영체제는 모든 열리파닝에 대한 정보를 갖는 열린 파일 테이블을 유지한다
- 임의의 파일 연산이 요구되면, 이 테이블에 대한 인덱스로 그 파일을 지정하므로 어떠한 탐색도 필요하지 않다
- 파일이 더 사용되지 않으면 프로세스에 의해 닫히고 운영체제는 열린 파일 테이블에 있는 항목을 제거하며, 락을 해제할 가능성이 있다
  - create()과 delete()는 열린 파일보다는 닫힌 파일을 대상으로 동작하는 시스템 콜이다
