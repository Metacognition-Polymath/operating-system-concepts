# 15. 파일 시스템 내부 구조(File-system internals)

- (13장) 파일 시스템은 데이터와 프로그램을 포함한 파일 내용에 대한 온라인 저장 및 접근 기법을 제공한다
- 이번 장은 주로 파일 시스템의 내부구조와 작동에 관한 것이다
  - 파일 사용을 구성하고
  - 저장 공간을 할당하고
  - 해제된 공간을 복구하고
  - 데이터 위치를 추적하고
  - 운영체제의 다른 부분과 보조저장장치를 상호 연결하는 방법을 자세히 살펴본다

#### 이 장의 목표

- 파일 시스템과 구현의 세부 사항에 대해 자세히 설명한다
- 부팅 및 파일 공유에 대해 탐구한다
- NFS를 예로 사용하여 원격 파일 시스템을 설명한다

## 15.1 파일 시스템 (File Systems)

- 컴퓨터 시스템에는 여러 저장장치가 있을 수 있다
- 컴퓨터 시스템은 또한 다양한 개수의 파일 시스템을 가질 수 있다

#### 그림 15.1 전형적인 파일 시스템의 구성

- 볼륨1, 2 > 파티션A, B > {디렉터리, 파일} => 저장 장치 1

#### 그림 15.2 Solaris 파일 시스템

- Solaris 파일 시스템
  - / : ufs
  - /tmp : tmpfs
  - /system/object : objfs
  - /system/contract : ctfs
  - / opt : ufs
  - /lib/libc.so.1 : lofs
  - /proc : procfs
- tmpfs : 휘발성 메인 메모리에 생성되고 시스템이 재부팅되거나 고장 났을 때 파일 시스템의 내용이 지워지는 "임시" 파일 시스템
- objfs : 디버거가 커널 심볼을 접근할 수 있게 하는 "가상" 파일 시스템
  - 실제로는 파일 시스템으로 보이는 커널 인터페이스
- ctfs : 시스템이 부트될 때 시작하여 운영체제가 실행되는 동안 실행되어야 하는 프로세스를 관리하기 위한 "contract" 정보를 저장하기 위한 가상 파일 시스템
- lofs : 한 파일 시스템 대신에 다른 파일 시스템에 접근할 수 있게 하는 "loop back" 파일 시스템
- procfs : 모든 프로세스에 관한 정보를 파일 시스템 형태로 보여주는 가상 파일 시스템
- ufs, zfs : 범용 파일 시스템

## 15.2 파일 시스템 마운팅(File System Mounting)

- 파일 시스템은 프로세스들에 의해 사용되기 전에 마운트 되어야 한다
- 디렉터리 구조는 다양한 볼륨으로 만들어 질 수 있는데, 각 파티션들이 마운트되어야 파일 시스템 네임 스페이스 안에서 이용 가능하다

- 마운트 과정
  - 운영체제에서 장치 이름과 마운트 포인트(파일시스템을 부착할 수 있는 파일 구조 내의 위치)를 준다
    - 일반적으로 마운트 포인트는 마운트되는 파일 시스템이 부착될 비어있는 디렉터리이다
  - 몇몇 운영체제는 파일 시스템의 유형이 제공되어야 하고, 다른 운영체제는 장치의 구조를 검사하여 파일 시스템의 유형을 결정한다
  - 운영체제는 장치가 유효한 파일 시스템을 포함하는지 확인한다
  - 운영체제는 파일 시스템이 지정된 마운트 포인트에 마운트되었음을 디렉터리 구조에 기록한다
- 이 기법은 운영체제가 디렉터리 구조를 순회하고 파일 시스템을 적절히 전환할 수 있게 하고
  - 심지어 파일 시스템의 유형도 필요에 따라 적절히 전환할 수 있게 한다

#### 그림 15.3 파일 시스템. 기존 파일 시스템, 마운트되지 않은 볼륨

- 파일 마운팅 설명
- 마운트된 볼륨에만 접근이 가능하다
  - 파티션이 언마운트되면 파일 시스템은 다시 그림 15.3에 보인 상황으로 복원된다
- 시스템은 기능을 명확하게 나타내기 위해 의미(semantic)를 부여한다
- 예를 들어, 시스템은 파일을 포함하고 있는 디렉터리에 대해 마운트를 허가하지 않거나
  - 또는 마운트된 파일 시스템만 그 디렉터리에서 사용할 수 있게 하고 기존 파일들은 언마운트될 때 까지 사용할 수 없게 만들 수 있다
  - 언마운트 후에는 마운트되었던 파일 시스템은 사용이 끝나고 기존 파일들이 다시 사용 가능해진다
- 다른 예로, 어떤 시스템은 다른 마운트 포인트에 같은 파일 시스템을 반복적으로 마운트하는 것을 허용하거나

  - 파일 시스템당 한 번의 마운트를 허용할 수 있다

- macOS 운영체제의 행동을 고려해보자
  - todo 이어서 공부하기(659쪽 부터)
